import"./FormItem.vue_vue_type_style_index_0_scoped_4a704015_lang-BWnScUmG.js";import{d as J,r as w,A as W,c as C,h as f,f as y,g as B,u as x,i as M,b as t,m as k,o as n,G as Z,F as N,a as e,e as L,w as l,s as G,t as O,j as Q,k as ee,I as le,_ as ae,B as de}from"./index-DoUELWe3.js";const ie={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ce=J({__name:"Database",setup(R){const c=w(!1),b=async()=>{const{connected:_}=await k.getDatabaseConnectStatus();c.value=_},d=async()=>{const{connected:_}=await k.connectDatabase();c.value=_},g=async()=>{const{connected:_}=await k.closeConnection();c.value=_},i=_=>{_?d():g()};return W(()=>{b()}),(_,p)=>{const V=t("el-switch");return n(),C("div",ie,[p[1]||(p[1]=f(" 数据库 ")),x(M)?(n(),y(V,{key:0,modelValue:c.value,"onUpdate:modelValue":p[0]||(p[0]=U=>c.value=U),onChange:i},null,8,["modelValue"])):B("",!0)])}}}),me=["onClick"],re={style:{display:"flex",gap:"5px"}},_e={key:0},pe={class:"dialog-footer"},ve=J({__name:"DataBaseTableNav",emits:["select"],setup(R,{emit:c}){const b=c,d=[{title:"cid",key:"cid",isEdit:!1},{title:"name",key:"name"},{title:"type",key:"type"},{title:"notnull",key:"notnull"},{title:"dflt_value",key:"dflt_value"},{title:"pk",key:"pk"},{title:"column",key:"column"}],g=w(),i=w({}),_=w([]),p=Z(()=>{var o;return[...((o=i.value)==null?void 0:o.rows)||[],..._.value]}),V=async()=>{const o=await k.getAllTable()||[];g.value=o},U=async o=>{await k.delTable(o),V()},Y=o=>{b("select",o.name)},P=async()=>{r.value.name&&(await k.addTable(r.value.name,r.value.title,p.value),V())},T=async o=>{if(!r.value.name)return;const a=p.value.map(I=>({...I,isAdd:void 0}));await k.updateTable(r.value.name,r.value.title,a,o?A.value:void 0),V()},m=async()=>{const o=p.value.filter(a=>a.isAdd);await k.addTableColumn(r.value.name,o)},S=async o=>{i.value=await k.getTableInfo(o)},z=async()=>{await k.getAllDataJson()},E=w(!1),r=w({name:""}),A=w(""),H=()=>{E.value=!1,A.value="",_.value=[]},h=async o=>{o?(A.value=o.name,r.value={...o},await S(o.name),r.value={...o,name:i.value.name||o.name,title:i.value.title}):(r.value={name:""},i.value={}),E.value=!0},X=async()=>{A.value?(await T(A.value!==r.value.name),p.value.find(o=>o.isAdd)&&await m()):await P(),H()},q=()=>{_.value.push({isAdd:!0})};return W(()=>{V()}),(o,a)=>{const I=t("el-button"),j=t("el-text"),s=t("el-link"),v=t("el-input"),F=t("el-form-item"),D=t("el-option"),te=t("el-select"),ne=t("el-table-column"),oe=t("el-table"),se=t("el-form"),ue=t("el-dialog");return n(),C(N,null,[e(I,{size:"small",type:"primary",onClick:V},{default:l(()=>a[5]||(a[5]=[f("获取表")])),_:1}),x(M)?(n(),y(I,{key:0,size:"small",onClick:a[0]||(a[0]=u=>h())},{default:l(()=>a[6]||(a[6]=[f("添加数据表")])),_:1})):B("",!0),x(M)?(n(),y(I,{key:1,size:"small",onClick:a[1]||(a[1]=u=>z())},{default:l(()=>a[7]||(a[7]=[f("导出")])),_:1})):B("",!0),L("div",null,[(n(!0),C(N,null,G(g.value,u=>(n(),C("div",null,[L("div",{class:"table-item",onClick:$=>Y(u)},[e(j,{class:"mx-1"},{default:l(()=>[f(O(u.name),1)]),_:2},1024),L("div",re,[x(M)?(n(),y(s,{key:0,type:"primary",icon:x(ee),onClick:Q($=>h(u),["stop"])},null,8,["icon","onClick"])):B("",!0),x(M)?(n(),y(s,{key:1,type:"danger",icon:x(le),onClick:Q($=>U(u.name),["stop"])},null,8,["icon","onClick"])):B("",!0)])],8,me)]))),256))]),e(ue,{modelValue:E.value,"onUpdate:modelValue":a[4]||(a[4]=u=>E.value=u),title:"添加数据表",width:"700","before-close":H},{footer:l(()=>[L("div",pe,[e(I,{onClick:H},{default:l(()=>a[9]||(a[9]=[f("取消")])),_:1}),e(I,{type:"primary",onClick:X},{default:l(()=>a[10]||(a[10]=[f(" 确定 ")])),_:1})])]),default:l(()=>[e(se,{model:r.value,"label-width":"auto",style:{"max-width":"600px"}},{default:l(()=>[e(F,{label:"数据表"},{default:l(()=>[e(v,{modelValue:r.value.name,"onUpdate:modelValue":a[2]||(a[2]=u=>r.value.name=u)},null,8,["modelValue"])]),_:1}),e(F,{label:"数据表名"},{default:l(()=>[e(v,{modelValue:r.value.title,"onUpdate:modelValue":a[3]||(a[3]=u=>r.value.title=u)},null,8,["modelValue"])]),_:1}),e(oe,{data:p.value,style:{width:"100%"},border:""},{default:l(()=>[(n(),C(N,null,G(d,u=>e(ne,{label:u.title,prop:u.key},{default:l($=>[u.isEdit!==!1&&($.row.isAdd||u.key==="column")?(n(),C("div",_e,[u.key==="type"?(n(),y(te,{key:0,modelValue:$.row[u.key],"onUpdate:modelValue":K=>$.row[u.key]=K},{default:l(()=>[e(D,{value:"TEXT"}),e(D,{value:"CLOB"}),e(D,{value:"INTEGER"}),e(D,{value:"CHAR"}),e(D,{value:"NULL"}),e(D,{value:"REAL"}),e(D,{value:"BLOB"}),e(D,{value:"DATETIME"}),e(D,{value:"DATE"}),e(D,{value:"HHH"})]),_:2},1032,["modelValue","onUpdate:modelValue"])):(n(),y(v,{key:1,modelValue:$.row[u.key],"onUpdate:modelValue":K=>$.row[u.key]=K},null,8,["modelValue","onUpdate:modelValue"]))])):(n(),y(j,{key:1},{default:l(()=>[f(O($.row[u.key]),1)]),_:2},1024))]),_:2},1032,["label","prop"])),64))]),_:1},8,["data"]),e(I,{class:"mt-4",style:{width:"100%"},onClick:q},{default:l(()=>a[8]||(a[8]=[f(" 添加字段 ")])),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),fe=ae(ve,[["__scopeId","data-v-9484bfc6"]]),ye={class:"card-header"},ke={key:0},be={key:1,style:{"max-height":"50px"}},we={class:"dialog-footer"},Ce=J({__name:"TableData",props:{title:{},name:{},tableInfoColumn:{}},setup(R){const c=R,b=w(),d=w({}),g=Z(()=>c.tableInfoColumn?c.tableInfoColumn:[]),i=async()=>{b.value=await k.getDataList(c.name)},_=async()=>{await k.addDataItem(c.name,d.value),i()},p=async()=>{await k.updateDataItem(c.name,d.value),i()},V=async T=>{await k.deleteDataItem(c.name,T.id),i()},U=w(!1),Y=T=>{d.value=T?{...T}:{},U.value=!0},P=async()=>{d.value.id?await p():await _(),U.value=!1};return de(()=>c.name,()=>i()),i(),(T,m)=>{const S=t("el-button"),z=t("el-link"),E=t("el-text"),r=t("el-table-column"),A=t("el-table"),H=t("el-card"),h=t("el-input"),X=t("el-option"),q=t("el-select"),o=t("el-date-picker"),a=t("el-form-item"),I=t("el-form"),j=t("el-dialog");return n(),C(N,null,[e(H,{shadow:"always",title:""},{header:l(()=>[L("div",ye,[L("span",null,O(T.title||"数据表")+"("+O(T.name)+")数据",1)])]),default:l(()=>[x(M)?(n(),y(S,{key:0,onClick:m[0]||(m[0]=s=>Y())},{default:l(()=>m[3]||(m[3]=[f("添加")])),_:1})):B("",!0),e(A,{data:b.value,style:{width:"100%"},border:""},{default:l(()=>[(n(!0),C(N,null,G(g.value,s=>(n(),y(r,{label:s.title,prop:s.key},{default:l(v=>[s.key==="action"?(n(),C("div",ke,[e(z,{type:"primary",icon:x(ee),onClick:F=>Y(v.row)},{default:l(()=>m[4]||(m[4]=[f(" 修改 ")])),_:2},1032,["icon","onClick"]),e(z,{type:"danger",icon:x(le),style:{"margin-left":"10px"},onClick:F=>V(v.row)},{default:l(()=>m[5]||(m[5]=[f(" 删除 ")])),_:2},1032,["icon","onClick"])])):(n(),C("div",be,[e(E,{"line-clamp":"2"},{default:l(()=>[f(O(v.row[s.key]),1)]),_:2},1024)]))]),_:2},1032,["label","prop"]))),256))]),_:1},8,["data"])]),_:1}),e(j,{modelValue:U.value,"onUpdate:modelValue":m[2]||(m[2]=s=>U.value=s)},{footer:l(()=>[L("div",we,[e(S,{onClick:m[1]||(m[1]=s=>U.value=!1)},{default:l(()=>m[6]||(m[6]=[f("取消")])),_:1}),e(S,{type:"primary",onClick:P},{default:l(()=>m[7]||(m[7]=[f(" 确定 ")])),_:1})])]),default:l(()=>[e(I,{model:d.value,"label-width":"auto",style:{"max-width":"600px"}},{default:l(()=>[(n(!0),C(N,null,G(T.tableInfoColumn,s=>(n(),y(a,{label:s.title},{default:l(()=>[s.type==="CLOB"?(n(),y(h,{key:0,modelValue:d.value[s.key],"onUpdate:modelValue":v=>d.value[s.key]=v,rows:2,type:"textarea",placeholder:"Please input"},null,8,["modelValue","onUpdate:modelValue"])):s.type==="CHAR"?(n(),y(q,{key:1,modelValue:d.value[s.key],"onUpdate:modelValue":v=>d.value[s.key]=v,placeholder:"Select"},{default:l(()=>[e(X,{label:"测试",value:"ce"})]),_:2},1032,["modelValue","onUpdate:modelValue"])):s.type==="DATETIME"?(n(),y(o,{key:2,modelValue:d.value[s.key],"onUpdate:modelValue":v=>d.value[s.key]=v,type:"date","value-format":"YYYY-MM-DD",placeholder:"Pick a day"},null,8,["modelValue","onUpdate:modelValue"])):(n(),y(h,{key:3,modelValue:d.value[s.key],"onUpdate:modelValue":v=>d.value[s.key]=v,disabled:s.key==="id"},null,8,["modelValue","onUpdate:modelValue","disabled"]))]),_:2},1032,["label"]))),256))]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),Ve={class:"manage-page"},ge=J({__name:"Manage",setup(R){const c=w(),b=w({name:"",rows:[]}),d=async g=>{b.value=await k.getTableInfo(g),b.value.name=g,c.value=b.value.rows.map(i=>({title:i.column||i.name,key:i.name,type:i.type}))};return(g,i)=>{const _=t("el-card"),p=t("el-col"),V=t("el-row");return n(),C("div",Ve,[e(V,{gutter:20},{default:l(()=>[e(p,{span:6},{default:l(()=>[e(_,{shadow:"always"},{header:l(()=>[e(ce)]),default:l(()=>[e(fe,{onSelect:d})]),_:1})]),_:1}),e(p,{span:18},{default:l(()=>[e(Ce,{title:b.value.title,name:b.value.name,tableInfoColumn:c.value},null,8,["title","name","tableInfoColumn"])]),_:1})]),_:1})])}}}),De=ae(ge,[["__scopeId","data-v-bec6949e"]]);export{De as default};
