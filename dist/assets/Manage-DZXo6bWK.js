import"./FormItem.vue_vue_type_style_index_0_scoped_4a704015_lang-BnW_dQ4F.js";import{m as y}from"./manageService-Di4UyXTv.js";import{c as B}from"./index-Bakq3o7x.js";import{d as P,r as w,x as W,c as C,h as f,f as k,g as M,u as D,b as t,o as n,z as Z,F as N,a as e,e as L,w as l,m as J,t as z,i as Q,j as ee,A as le,_ as ae,y as de}from"./index-CeFBHVDu.js";import"./httpService-B_3VVXSe.js";const ie={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ce=P({__name:"Database",setup(O){const c=w(!1),b=async()=>{const{connected:p}=await y.getDatabaseConnectStatus();c.value=p},d=async()=>{const{connected:p}=await y.connectDatabase();c.value=p},g=async()=>{const{connected:p}=await y.closeConnection();c.value=p},i=p=>{p?d():g()};return W(()=>{b()}),(p,_)=>{const V=t("el-switch");return n(),C("div",ie,[_[1]||(_[1]=f(" 数据库 ")),D(B)?(n(),k(V,{key:0,modelValue:c.value,"onUpdate:modelValue":_[0]||(_[0]=U=>c.value=U),onChange:i},null,8,["modelValue"])):M("",!0)])}}}),me=["onClick"],re={style:{display:"flex",gap:"5px"}},pe={key:0},_e={class:"dialog-footer"},ve=P({__name:"DataBaseTableNav",emits:["select"],setup(O,{emit:c}){const b=c,d=[{title:"cid",key:"cid",isEdit:!1},{title:"name",key:"name"},{title:"type",key:"type"},{title:"notnull",key:"notnull"},{title:"dflt_value",key:"dflt_value"},{title:"pk",key:"pk"},{title:"column",key:"column"}],g=w(),i=w({}),p=w([]),_=Z(()=>{var o;return[...((o=i.value)==null?void 0:o.rows)||[],...p.value]}),V=async()=>{const o=await y.getAllTable()||[];g.value=o},U=async o=>{await y.delTable(o),V()},R=o=>{b("select",o.name)},G=async()=>{r.value.name&&(await y.addTable(r.value.name,r.value.title,_.value),V())},T=async o=>{if(!r.value.name)return;const a=_.value.map(I=>({...I,isAdd:void 0}));await y.updateTable(r.value.name,r.value.title,a,o?A.value:void 0),V()},m=async()=>{const o=_.value.filter(a=>a.isAdd);await y.addTableColumn(r.value.name,o)},S=async o=>{i.value=await y.getTableInfo(o)},Y=async()=>{await y.getAllDataJson()},E=w(!1),r=w({name:""}),A=w(""),H=()=>{E.value=!1,A.value="",p.value=[]},h=async o=>{o?(A.value=o.name,r.value={...o},await S(o.name),r.value={...o,name:i.value.name||o.name,title:i.value.title}):(r.value={name:""},i.value={}),E.value=!0},X=async()=>{A.value?(await T(A.value!==r.value.name),_.value.find(o=>o.isAdd)&&await m()):await G(),H()},q=()=>{p.value.push({isAdd:!0})};return W(()=>{V()}),(o,a)=>{const I=t("el-button"),j=t("el-text"),s=t("el-link"),v=t("el-input"),F=t("el-form-item"),x=t("el-option"),te=t("el-select"),ne=t("el-table-column"),oe=t("el-table"),se=t("el-form"),ue=t("el-dialog");return n(),C(N,null,[e(I,{size:"small",type:"primary",onClick:V},{default:l(()=>a[5]||(a[5]=[f("获取表")])),_:1}),D(B)?(n(),k(I,{key:0,size:"small",onClick:a[0]||(a[0]=u=>h())},{default:l(()=>a[6]||(a[6]=[f("添加数据表")])),_:1})):M("",!0),D(B)?(n(),k(I,{key:1,size:"small",onClick:a[1]||(a[1]=u=>Y())},{default:l(()=>a[7]||(a[7]=[f("导出")])),_:1})):M("",!0),L("div",null,[(n(!0),C(N,null,J(g.value,u=>(n(),C("div",null,[L("div",{class:"table-item",onClick:$=>R(u)},[e(j,{class:"mx-1"},{default:l(()=>[f(z(u.name),1)]),_:2},1024),L("div",re,[D(B)?(n(),k(s,{key:0,type:"primary",icon:D(ee),onClick:Q($=>h(u),["stop"])},null,8,["icon","onClick"])):M("",!0),D(B)?(n(),k(s,{key:1,type:"danger",icon:D(le),onClick:Q($=>U(u.name),["stop"])},null,8,["icon","onClick"])):M("",!0)])],8,me)]))),256))]),e(ue,{modelValue:E.value,"onUpdate:modelValue":a[4]||(a[4]=u=>E.value=u),title:"添加数据表",width:"700","before-close":H},{footer:l(()=>[L("div",_e,[e(I,{onClick:H},{default:l(()=>a[9]||(a[9]=[f("取消")])),_:1}),e(I,{type:"primary",onClick:X},{default:l(()=>a[10]||(a[10]=[f(" 确定 ")])),_:1})])]),default:l(()=>[e(se,{model:r.value,"label-width":"auto",style:{"max-width":"600px"}},{default:l(()=>[e(F,{label:"数据表"},{default:l(()=>[e(v,{modelValue:r.value.name,"onUpdate:modelValue":a[2]||(a[2]=u=>r.value.name=u)},null,8,["modelValue"])]),_:1}),e(F,{label:"数据表名"},{default:l(()=>[e(v,{modelValue:r.value.title,"onUpdate:modelValue":a[3]||(a[3]=u=>r.value.title=u)},null,8,["modelValue"])]),_:1}),e(oe,{data:_.value,style:{width:"100%"},border:""},{default:l(()=>[(n(),C(N,null,J(d,u=>e(ne,{label:u.title,prop:u.key},{default:l($=>[u.isEdit!==!1&&($.row.isAdd||u.key==="column")?(n(),C("div",pe,[u.key==="type"?(n(),k(te,{key:0,modelValue:$.row[u.key],"onUpdate:modelValue":K=>$.row[u.key]=K},{default:l(()=>[e(x,{value:"TEXT"}),e(x,{value:"CLOB"}),e(x,{value:"INTEGER"}),e(x,{value:"CHAR"}),e(x,{value:"NULL"}),e(x,{value:"REAL"}),e(x,{value:"BLOB"}),e(x,{value:"DATETIME"}),e(x,{value:"DATE"}),e(x,{value:"HHH"})]),_:2},1032,["modelValue","onUpdate:modelValue"])):(n(),k(v,{key:1,modelValue:$.row[u.key],"onUpdate:modelValue":K=>$.row[u.key]=K},null,8,["modelValue","onUpdate:modelValue"]))])):(n(),k(j,{key:1},{default:l(()=>[f(z($.row[u.key]),1)]),_:2},1024))]),_:2},1032,["label","prop"])),64))]),_:1},8,["data"]),e(I,{class:"mt-4",style:{width:"100%"},onClick:q},{default:l(()=>a[8]||(a[8]=[f(" 添加字段 ")])),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),fe=ae(ve,[["__scopeId","data-v-9484bfc6"]]),ye={class:"card-header"},ke={key:0},be={key:1,style:{"max-height":"50px"}},we={class:"dialog-footer"},Ce=P({__name:"TableData",props:{title:{},name:{},tableInfoColumn:{}},setup(O){const c=O,b=w(),d=w({}),g=Z(()=>c.tableInfoColumn?c.tableInfoColumn:[]),i=async()=>{b.value=await y.getDataList(c.name,{})},p=async()=>{await y.addDataItem(c.name,d.value),i()},_=async()=>{await y.updateDataItem(c.name,d.value),i()},V=async T=>{await y.deleteDataItem(c.name,T.id),i()},U=w(!1),R=T=>{d.value=T?{...T}:{},U.value=!0},G=async()=>{d.value.id?await _():await p(),U.value=!1};return de(()=>c.name,()=>i()),i(),(T,m)=>{const S=t("el-button"),Y=t("el-link"),E=t("el-text"),r=t("el-table-column"),A=t("el-table"),H=t("el-card"),h=t("el-input"),X=t("el-option"),q=t("el-select"),o=t("el-date-picker"),a=t("el-form-item"),I=t("el-form"),j=t("el-dialog");return n(),C(N,null,[e(H,{shadow:"always",title:""},{header:l(()=>[L("div",ye,[L("span",null,z(T.title||"数据表")+"("+z(T.name)+")数据",1)])]),default:l(()=>[D(B)?(n(),k(S,{key:0,onClick:m[0]||(m[0]=s=>R())},{default:l(()=>m[3]||(m[3]=[f("添加")])),_:1})):M("",!0),e(A,{data:b.value,style:{width:"100%"},border:""},{default:l(()=>[(n(!0),C(N,null,J(g.value,s=>(n(),k(r,{label:s.title,prop:s.key},{default:l(v=>[s.key==="action"?(n(),C("div",ke,[e(Y,{type:"primary",icon:D(ee),onClick:F=>R(v.row)},{default:l(()=>m[4]||(m[4]=[f(" 修改 ")])),_:2},1032,["icon","onClick"]),e(Y,{type:"danger",icon:D(le),style:{"margin-left":"10px"},onClick:F=>V(v.row)},{default:l(()=>m[5]||(m[5]=[f(" 删除 ")])),_:2},1032,["icon","onClick"])])):(n(),C("div",be,[e(E,{"line-clamp":"2"},{default:l(()=>[f(z(v.row[s.key]),1)]),_:2},1024)]))]),_:2},1032,["label","prop"]))),256))]),_:1},8,["data"])]),_:1}),e(j,{modelValue:U.value,"onUpdate:modelValue":m[2]||(m[2]=s=>U.value=s)},{footer:l(()=>[L("div",we,[e(S,{onClick:m[1]||(m[1]=s=>U.value=!1)},{default:l(()=>m[6]||(m[6]=[f("取消")])),_:1}),e(S,{type:"primary",onClick:G},{default:l(()=>m[7]||(m[7]=[f(" 确定 ")])),_:1})])]),default:l(()=>[e(I,{model:d.value,"label-width":"auto",style:{"max-width":"600px"}},{default:l(()=>[(n(!0),C(N,null,J(T.tableInfoColumn,s=>(n(),k(a,{label:s.title},{default:l(()=>[s.type==="CLOB"?(n(),k(h,{key:0,modelValue:d.value[s.key],"onUpdate:modelValue":v=>d.value[s.key]=v,rows:2,type:"textarea",placeholder:"Please input"},null,8,["modelValue","onUpdate:modelValue"])):s.type==="CHAR"?(n(),k(q,{key:1,modelValue:d.value[s.key],"onUpdate:modelValue":v=>d.value[s.key]=v,placeholder:"Select"},{default:l(()=>[e(X,{label:"测试",value:"ce"})]),_:2},1032,["modelValue","onUpdate:modelValue"])):s.type==="DATETIME"?(n(),k(o,{key:2,modelValue:d.value[s.key],"onUpdate:modelValue":v=>d.value[s.key]=v,type:"date","value-format":"YYYY-MM-DD",placeholder:"Pick a day"},null,8,["modelValue","onUpdate:modelValue"])):(n(),k(h,{key:3,modelValue:d.value[s.key],"onUpdate:modelValue":v=>d.value[s.key]=v,disabled:s.key==="id"},null,8,["modelValue","onUpdate:modelValue","disabled"]))]),_:2},1032,["label"]))),256))]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),Ve={class:"manage-page"},ge=P({__name:"Manage",setup(O){const c=w(),b=w({name:"",rows:[]}),d=async g=>{b.value=await y.getTableInfo(g),b.value.name=g,c.value=b.value.rows.map(i=>({title:i.column||i.name,key:i.name,type:i.type}))};return(g,i)=>{const p=t("el-card"),_=t("el-col"),V=t("el-row");return n(),C("div",Ve,[e(V,{gutter:20},{default:l(()=>[e(_,{span:6},{default:l(()=>[e(p,{shadow:"always"},{header:l(()=>[e(ce)]),default:l(()=>[e(fe,{onSelect:d})]),_:1})]),_:1}),e(_,{span:18},{default:l(()=>[e(Ce,{title:b.value.title,name:b.value.name,tableInfoColumn:c.value},null,8,["title","name","tableInfoColumn"])]),_:1})]),_:1})])}}}),$e=ae(ge,[["__scopeId","data-v-bec6949e"]]);export{$e as default};
