import"./FormItem.vue_vue_type_style_index_0_scoped_4a704015_lang-zCBhWx_j.js";import{m as y}from"./manageService-Di4UyXTv.js";import{d as P,r as V,s as Q,h as C,g as _,c as v,f as B,u as D,a,o as t,x as W,F as N,e,b as E,w as l,i as J,t as h,j as K,k as Z,y as ee,_ as le,v as ue}from"./index-DfV2gFvH.js";import"./httpService-B_3VVXSe.js";const M=!1,de={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ie=P({__name:"Database",setup(O){const c=V(!1),b=async()=>{const{connected:p}=await y.getDatabaseConnectStatus();c.value=p},u=async()=>{const{connected:p}=await y.connectDatabase();c.value=p},T=async()=>{const{connected:p}=await y.closeConnection();c.value=p},d=p=>{p?u():T()};return Q(()=>{b()}),(p,k)=>{const g=a("el-switch");return t(),C("div",de,[k[1]||(k[1]=_(" 数据库 ")),D(M)?(t(),v(g,{key:0,modelValue:c.value,"onUpdate:modelValue":k[0]||(k[0]=U=>c.value=U),onChange:d},null,8,["modelValue"])):B("",!0)])}}}),ce=["onClick"],me={style:{display:"flex",gap:"5px"}},re={key:0},pe={class:"dialog-footer"},_e=P({__name:"DataBaseTableNav",emits:["select"],setup(O,{emit:c}){const b=c,u=[{title:"cid",key:"cid",isEdit:!1},{title:"name",key:"name"},{title:"type",key:"type"},{title:"notnull",key:"notnull"},{title:"dflt_value",key:"dflt_value"},{title:"pk",key:"pk"},{title:"column",key:"column"}],T=V(),d=V({}),p=V([]),k=W(()=>[...d.value.rows,...p.value]),g=async()=>{const i=await y.getAllTable()||[];T.value=i},U=async i=>{await y.delTable(i),g()},R=i=>{b("select",i.name)},G=async()=>{r.value.name&&(await y.addTable(r.value.name,r.value.title,k.value),g())},I=async i=>{if(!r.value.name)return;const n=k.value.map(x=>({...x,isAdd:void 0}));await y.updateTable(r.value.name,r.value.title,n,i?L.value:void 0),g()},m=async i=>{d.value=await y.getTableInfo(i)},S=async()=>{await y.getAllDataJson()},A=V(!1),r=V({name:""}),L=V(""),H=()=>{A.value=!1,L.value="",p.value=[]},Y=async i=>{i?(L.value=i.name,r.value={...i},await m(i.name),r.value={...i,name:d.value.name||i.name,title:d.value.title}):(r.value={name:""},d.value={}),A.value=!0},z=async()=>{L.value?await I(L.value!==r.value.name):await G(),H()},X=()=>{p.value.push({isAdd:!0})};return Q(()=>{g()}),(i,n)=>{const x=a("el-button"),j=a("el-text"),F=a("el-link"),o=a("el-input"),f=a("el-form-item"),w=a("el-option"),ae=a("el-select"),te=a("el-table-column"),ne=a("el-table"),oe=a("el-form"),se=a("el-dialog");return t(),C(N,null,[e(x,{size:"small",type:"primary",onClick:g},{default:l(()=>n[5]||(n[5]=[_("获取表")])),_:1}),D(M)?(t(),v(x,{key:0,size:"small",onClick:n[0]||(n[0]=s=>Y())},{default:l(()=>n[6]||(n[6]=[_("添加数据表")])),_:1})):B("",!0),D(M)?(t(),v(x,{key:1,size:"small",onClick:n[1]||(n[1]=s=>S())},{default:l(()=>n[7]||(n[7]=[_("导出")])),_:1})):B("",!0),E("div",null,[(t(!0),C(N,null,J(T.value,s=>(t(),C("div",null,[E("div",{class:"table-item",onClick:$=>R(s)},[e(j,{class:"mx-1"},{default:l(()=>[_(h(s.name),1)]),_:2},1024),E("div",me,[D(M)?(t(),v(F,{key:0,type:"primary",icon:D(Z),onClick:K($=>Y(s),["stop"])},null,8,["icon","onClick"])):B("",!0),D(M)?(t(),v(F,{key:1,type:"danger",icon:D(ee),onClick:K($=>U(s.name),["stop"])},null,8,["icon","onClick"])):B("",!0)])],8,ce)]))),256))]),e(se,{modelValue:A.value,"onUpdate:modelValue":n[4]||(n[4]=s=>A.value=s),title:"添加数据表",width:"700","before-close":H},{footer:l(()=>[E("div",pe,[e(x,{onClick:H},{default:l(()=>n[9]||(n[9]=[_("取消")])),_:1}),e(x,{type:"primary",onClick:z},{default:l(()=>n[10]||(n[10]=[_(" 确定 ")])),_:1})])]),default:l(()=>[e(oe,{model:r.value,"label-width":"auto",style:{"max-width":"600px"}},{default:l(()=>[e(f,{label:"数据表"},{default:l(()=>[e(o,{modelValue:r.value.name,"onUpdate:modelValue":n[2]||(n[2]=s=>r.value.name=s)},null,8,["modelValue"])]),_:1}),e(f,{label:"数据表名"},{default:l(()=>[e(o,{modelValue:r.value.title,"onUpdate:modelValue":n[3]||(n[3]=s=>r.value.title=s)},null,8,["modelValue"])]),_:1}),e(ne,{data:k.value,style:{width:"100%"},border:""},{default:l(()=>[(t(),C(N,null,J(u,s=>e(te,{label:s.title,prop:s.key},{default:l($=>[s.isEdit!==!1&&($.row.isAdd||s.key==="column")?(t(),C("div",re,[s.key==="type"?(t(),v(ae,{key:0,modelValue:$.row[s.key],"onUpdate:modelValue":q=>$.row[s.key]=q},{default:l(()=>[e(w,{value:"TEXT"}),e(w,{value:"CLOB"}),e(w,{value:"INTEGER"}),e(w,{value:"CHAR"}),e(w,{value:"NULL"}),e(w,{value:"REAL"}),e(w,{value:"BLOB"}),e(w,{value:"DATETIME"}),e(w,{value:"DATE"}),e(w,{value:"HHH"})]),_:2},1032,["modelValue","onUpdate:modelValue"])):(t(),v(o,{key:1,modelValue:$.row[s.key],"onUpdate:modelValue":q=>$.row[s.key]=q},null,8,["modelValue","onUpdate:modelValue"]))])):(t(),v(j,{key:1},{default:l(()=>[_(h($.row[s.key]),1)]),_:2},1024))]),_:2},1032,["label","prop"])),64))]),_:1},8,["data"]),e(x,{class:"mt-4",style:{width:"100%"},onClick:X},{default:l(()=>n[8]||(n[8]=[_(" 添加字段 ")])),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),ve=le(_e,[["__scopeId","data-v-15b14c75"]]),fe={class:"card-header"},ye={key:0},ke={key:1,style:{"max-height":"50px"}},be={class:"dialog-footer"},we=P({__name:"TableData",props:{title:{},name:{},tableInfoColumn:{}},setup(O){const c=O,b=V(),u=V({}),T=W(()=>c.tableInfoColumn?c.tableInfoColumn:[]),d=async()=>{b.value=await y.getDataList(c.name,{})},p=async()=>{await y.addDataItem(c.name,u.value),d()},k=async()=>{await y.updateDataItem(c.name,u.value),d()},g=async I=>{await y.deleteDataItem(c.name,I.id),d()},U=V(!1),R=I=>{u.value=I?{...I}:{},U.value=!0},G=async()=>{u.value.id?await k():await p(),U.value=!1};return ue(()=>c.name,()=>d()),d(),(I,m)=>{const S=a("el-button"),A=a("el-link"),r=a("el-text"),L=a("el-table-column"),H=a("el-table"),Y=a("el-card"),z=a("el-input"),X=a("el-option"),i=a("el-select"),n=a("el-date-picker"),x=a("el-form-item"),j=a("el-form"),F=a("el-dialog");return t(),C(N,null,[e(Y,{shadow:"always",title:""},{header:l(()=>[E("div",fe,[E("span",null,h(I.title||"数据表")+"("+h(I.name)+")数据",1)])]),default:l(()=>[D(M)?(t(),v(S,{key:0,onClick:m[0]||(m[0]=o=>R())},{default:l(()=>m[3]||(m[3]=[_("添加")])),_:1})):B("",!0),e(H,{data:b.value,style:{width:"100%"},border:""},{default:l(()=>[(t(!0),C(N,null,J(T.value,o=>(t(),v(L,{label:o.title,prop:o.key},{default:l(f=>[o.key==="action"?(t(),C("div",ye,[e(A,{type:"primary",icon:D(Z),onClick:w=>R(f.row)},{default:l(()=>m[4]||(m[4]=[_(" 修改 ")])),_:2},1032,["icon","onClick"]),e(A,{type:"danger",icon:D(ee),style:{"margin-left":"10px"},onClick:w=>g(f.row)},{default:l(()=>m[5]||(m[5]=[_(" 删除 ")])),_:2},1032,["icon","onClick"])])):(t(),C("div",ke,[e(r,{"line-clamp":"2"},{default:l(()=>[_(h(f.row[o.key]),1)]),_:2},1024)]))]),_:2},1032,["label","prop"]))),256))]),_:1},8,["data"])]),_:1}),e(F,{modelValue:U.value,"onUpdate:modelValue":m[2]||(m[2]=o=>U.value=o)},{footer:l(()=>[E("div",be,[e(S,{onClick:m[1]||(m[1]=o=>U.value=!1)},{default:l(()=>m[6]||(m[6]=[_("取消")])),_:1}),e(S,{type:"primary",onClick:G},{default:l(()=>m[7]||(m[7]=[_(" 确定 ")])),_:1})])]),default:l(()=>[e(j,{model:u.value,"label-width":"auto",style:{"max-width":"600px"}},{default:l(()=>[(t(!0),C(N,null,J(I.tableInfoColumn,o=>(t(),v(x,{label:o.title},{default:l(()=>[o.type==="CLOB"?(t(),v(z,{key:0,modelValue:u.value[o.key],"onUpdate:modelValue":f=>u.value[o.key]=f,rows:2,type:"textarea",placeholder:"Please input"},null,8,["modelValue","onUpdate:modelValue"])):o.type==="CHAR"?(t(),v(i,{key:1,modelValue:u.value[o.key],"onUpdate:modelValue":f=>u.value[o.key]=f,placeholder:"Select"},{default:l(()=>[e(X,{label:"测试",value:"ce"})]),_:2},1032,["modelValue","onUpdate:modelValue"])):o.type==="DATETIME"?(t(),v(n,{key:2,modelValue:u.value[o.key],"onUpdate:modelValue":f=>u.value[o.key]=f,type:"date","value-format":"YYYY-MM-DD",placeholder:"Pick a day"},null,8,["modelValue","onUpdate:modelValue"])):(t(),v(z,{key:3,modelValue:u.value[o.key],"onUpdate:modelValue":f=>u.value[o.key]=f,disabled:o.key==="id"},null,8,["modelValue","onUpdate:modelValue","disabled"]))]),_:2},1032,["label"]))),256))]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),Ve={class:"manage-page"},Ce=P({__name:"Manage",setup(O){const c=V(),b=V({name:"",rows:[]}),u=async T=>{b.value=await y.getTableInfo(T),b.value.name=T,c.value=b.value.rows.map(d=>({title:d.column||d.name,key:d.name,type:d.type}))};return(T,d)=>{const p=a("el-card"),k=a("el-col"),g=a("el-row");return t(),C("div",Ve,[e(g,{gutter:20},{default:l(()=>[e(k,{span:6},{default:l(()=>[e(p,{shadow:"always"},{header:l(()=>[e(ie)]),default:l(()=>[e(ve,{onSelect:u})]),_:1})]),_:1}),e(k,{span:18},{default:l(()=>[e(we,{title:b.value.title,name:b.value.name,tableInfoColumn:c.value},null,8,["title","name","tableInfoColumn"])]),_:1})]),_:1})])}}}),De=le(Ce,[["__scopeId","data-v-bec6949e"]]);export{De as default};
