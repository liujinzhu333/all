import"./FormItem.vue_vue_type_style_index_0_scoped_4a704015_lang-DclFhClF.js";import{a as se}from"./axios-upsvKRUO.js";import{d as F,r as k,z as K,p as o,o as c,c as w,e as f,a as e,h as Q,w as a,b as L,F as A,i as J,t as q,u as R,A as W,B as H,C as Y,f as B,_ as Z,k as ue}from"./index-B8hbdZB4.js";const p=se.create({baseURL:"/",timeout:1e4}),de=u=>{if(u.url==="/api/db/table/list")return"/all/sqlite_sequence.json";u.url};p.interceptors.request.use(u=>(u.url=de(u),u),u=>Promise.reject(u));p.interceptors.response.use(u=>u.data,u=>{if(u.response)switch(u.response.status){}return Promise.reject(u)});class ie{async getDatabaseConnectStatus(){return p.get("/api/db/status")}async connectDatabase(){return p.get("/api/db/connect")}async closeConnection(){return p.get("/api/db/close")}async getAllDataJson(){return p.get("/api/db/get_json")}async getAllTable(){return p.get("/api/db/table/list")}async addTable(t,n){return p.post("/api/db/table/create",{name:t,keys:n})}async delTable(t){return p.get("/api/db/table/delete",{params:{name:t}})}async addTableColumn(t,n){return p.post("/api/db/table/add_column",{name:t,keys:n})}async getTableInfo(t){return p.get("/api/db/table/info",{params:{name:t}})}async getDataList(t,n){return p.get(`/api/db/table/${t}/list`,{params:n})}async addDataItem(t,n){return p.post(`/api/db/table/${t}/add`,n)}async deleteDataItem(t,n){return p.get(`/api/db/table/${t}/delete`,{params:{id:n}})}async updateDataItem(t,n){return p.post(`/api/db/table/${t}/update`,n)}async getDataInfo(t,n){return p.get(`/api/db/table/${t}/info`,{params:{id:n}})}}const b=new ie,re={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ce=F({__name:"Database",setup(u){const t=k(!1),n=async()=>{const{connected:m}=await b.getDatabaseConnectStatus();t.value=m},v=async()=>{const{connected:m}=await b.connectDatabase();t.value=m},C=async()=>{const{connected:m}=await b.closeConnection();t.value=m},_=m=>{m?v():C()};return K(()=>{n()}),(m,y)=>{const V=o("el-switch");return c(),w("div",re,[y[1]||(y[1]=f(" 数据库 ")),e(V,{modelValue:t.value,"onUpdate:modelValue":y[0]||(y[0]=I=>t.value=I),onChange:_},null,8,["modelValue"])])}}}),me=["onClick"],pe={style:{display:"flex",gap:"5px"}},_e={key:0},fe={class:"dialog-footer"},be=F({__name:"DataBaseTableNav",emits:["select"],setup(u,{emit:t}){const n=t,v=[{title:"cid",key:"cid",isEdit:!1},{title:"name",key:"name"},{title:"type",key:"type"},{title:"notnull",key:"notnull"},{title:"dflt_value",key:"dflt_value"},{title:"pk",key:"pk"}],C=k(),_=k([]),m=k([]),y=Q(()=>[..._.value,...m.value]),V=async()=>{const i=await b.getAllTable()||[];C.value=i},I=async i=>{await b.delTable(i),V()},N=i=>{n("select",i.name)},P=async()=>{if(!g.value.name)return;const i=y.value.filter(l=>l.isAdd);await b.addTable(g.value.name,i),V()},D=async()=>{const i=y.value.filter(l=>l.isAdd);await b.addTableColumn(g.value.name,i)},r=async i=>{_.value=await b.getTableInfo(i)},S=async()=>{await b.getAllDataJson()},$=k(!1),g=k({name:""}),U=k(""),M=()=>{$.value=!1,U.value="",m.value=[]},j=i=>{i?(U.value=i.name,g.value={...i},r(i.name)):(g.value={name:""},_.value=[]),$.value=!0},G=async()=>{U.value?U.value!==g.value.name||await D():await P(),M()},O=()=>{m.value.push({isAdd:!0})};return K(()=>{V()}),(i,l)=>{const d=o("el-button"),x=o("el-text"),z=o("el-link"),h=o("el-input"),ee=o("el-form-item"),E=o("el-option"),te=o("el-select"),ae=o("el-table-column"),le=o("el-table"),ne=o("el-form"),oe=o("el-dialog");return c(),w(A,null,[e(d,{size:"small",type:"primary",onClick:V},{default:a(()=>l[5]||(l[5]=[f("获取表")])),_:1}),e(d,{size:"small",onClick:l[0]||(l[0]=s=>j())},{default:a(()=>l[6]||(l[6]=[f("添加数据表")])),_:1}),e(d,{size:"small",onClick:l[1]||(l[1]=s=>S())},{default:a(()=>l[7]||(l[7]=[f("导出")])),_:1}),L("div",null,[(c(!0),w(A,null,J(C.value,s=>(c(),w("div",null,[L("div",{class:"table-item",onClick:T=>N(s)},[e(x,{class:"mx-1"},{default:a(()=>[f(q(s.name),1)]),_:2},1024),L("div",pe,[e(z,{type:"primary",icon:R(W),onClick:H(T=>j(s),["stop"])},null,8,["icon","onClick"]),e(z,{type:"danger",icon:R(Y),onClick:H(T=>I(s.name),["stop"])},null,8,["icon","onClick"])])],8,me)]))),256))]),e(oe,{modelValue:$.value,"onUpdate:modelValue":l[4]||(l[4]=s=>$.value=s),title:"添加数据表",width:"700","before-close":M},{footer:a(()=>[L("div",fe,[e(d,{onClick:l[3]||(l[3]=s=>$.value=!1)},{default:a(()=>l[9]||(l[9]=[f("取消")])),_:1}),e(d,{type:"primary",onClick:G},{default:a(()=>l[10]||(l[10]=[f(" 确定 ")])),_:1})])]),default:a(()=>[e(ne,{model:g.value,"label-width":"auto",style:{"max-width":"600px"}},{default:a(()=>[e(ee,{label:"数据表名"},{default:a(()=>[e(h,{modelValue:g.value.name,"onUpdate:modelValue":l[2]||(l[2]=s=>g.value.name=s)},null,8,["modelValue"])]),_:1}),e(le,{data:y.value,style:{width:"100%"},border:""},{default:a(()=>[(c(),w(A,null,J(v,s=>e(ae,{label:s.title,prop:s.key},{default:a(T=>[T.row.isAdd&&s.isEdit!==!1?(c(),w("div",_e,[s.key==="type"?(c(),B(te,{key:0,modelValue:T.row[s.key],"onUpdate:modelValue":X=>T.row[s.key]=X},{default:a(()=>[e(E,{value:"TEXT"}),e(E,{value:"INTEGER"}),e(E,{value:"NULL"}),e(E,{value:"REAL"}),e(E,{value:"BLOB"})]),_:2},1032,["modelValue","onUpdate:modelValue"])):(c(),B(h,{key:1,modelValue:T.row[s.key],"onUpdate:modelValue":X=>T.row[s.key]=X},null,8,["modelValue","onUpdate:modelValue"]))])):(c(),B(x,{key:1},{default:a(()=>[f(q(T.row[s.key]),1)]),_:2},1024))]),_:2},1032,["label","prop"])),64))]),_:1},8,["data"]),e(d,{class:"mt-4",style:{width:"100%"},onClick:O},{default:a(()=>l[8]||(l[8]=[f(" 添加字段 ")])),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),ve=Z(be,[["__scopeId","data-v-07fbb642"]]),ye={class:"card-header"},ke={key:0},ge={class:"dialog-footer"},we=F({__name:"TableData",props:{name:{},tableInfoColumn:{}},setup(u){const t=u,n=k(),v=k({}),C=Q(()=>t.tableInfoColumn?[...t.tableInfoColumn,{title:"操作",key:"action"}]:[]),_=async()=>{n.value=await b.getDataList(t.name,{})},m=async()=>{await b.addDataItem(t.name,v.value),_()},y=async()=>{await b.updateDataItem(t.name,v.value),_()},V=async D=>{await b.deleteDataItem(t.name,D.id),_()},I=k(!1),N=D=>{v.value=D?{...D}:{},I.value=!0},P=async()=>{v.value.id?await y():await m(),I.value=!1};return ue(()=>t.name,()=>_()),_(),(D,r)=>{const S=o("el-button"),$=o("el-link"),g=o("el-text"),U=o("el-table-column"),M=o("el-table"),j=o("el-card"),G=o("el-input"),O=o("el-form-item"),i=o("el-form"),l=o("el-dialog");return c(),w(A,null,[e(j,{shadow:"always",title:""},{header:a(()=>[L("div",ye,[L("span",null,"数据表("+q(D.name)+")数据",1)])]),default:a(()=>[e(S,{onClick:r[0]||(r[0]=d=>N())},{default:a(()=>r[3]||(r[3]=[f("添加")])),_:1}),e(M,{data:n.value,style:{width:"100%"},border:""},{default:a(()=>[(c(!0),w(A,null,J(C.value,d=>(c(),B(U,{label:d.title,prop:d.key},{default:a(x=>[d.key==="action"?(c(),w("div",ke,[e($,{type:"primary",icon:R(W),onClick:z=>N(x.row)},{default:a(()=>r[4]||(r[4]=[f(" 修改 ")])),_:2},1032,["icon","onClick"]),e($,{type:"danger",icon:R(Y),style:{"margin-left":"10px"},onClick:z=>V(x.row)},{default:a(()=>r[5]||(r[5]=[f(" 删除 ")])),_:2},1032,["icon","onClick"])])):(c(),B(g,{key:1},{default:a(()=>[f(q(x.row[d.key]),1)]),_:2},1024))]),_:2},1032,["label","prop"]))),256))]),_:1},8,["data"])]),_:1}),e(l,{modelValue:I.value,"onUpdate:modelValue":r[2]||(r[2]=d=>I.value=d)},{footer:a(()=>[L("div",ge,[e(S,{onClick:r[1]||(r[1]=d=>I.value=!1)},{default:a(()=>r[6]||(r[6]=[f("取消")])),_:1}),e(S,{type:"primary",onClick:P},{default:a(()=>r[7]||(r[7]=[f(" 确定 ")])),_:1})])]),default:a(()=>[e(i,{model:v.value,"label-width":"auto",style:{"max-width":"600px"}},{default:a(()=>[(c(!0),w(A,null,J(D.tableInfoColumn,d=>(c(),B(O,{label:d.title},{default:a(()=>[e(G,{modelValue:v.value[d.key],"onUpdate:modelValue":x=>v.value[d.key]=x,disabled:d.key==="id"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["label"]))),256))]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),Ce={class:"manage-page"},Ve=F({__name:"Manage",setup(u){const t=k(),n=k({name:"",list:[]}),v=async C=>{n.value.list=await b.getTableInfo(C),n.value.name=C,t.value=n.value.list.map(_=>({title:_.name,key:_.name}))};return(C,_)=>{const m=o("el-card"),y=o("el-col"),V=o("el-row");return c(),w("div",Ce,[e(V,{gutter:20},{default:a(()=>[e(y,{span:6},{default:a(()=>[e(m,{shadow:"always"},{header:a(()=>[e(ce)]),default:a(()=>[e(ve,{onSelect:v})]),_:1})]),_:1}),e(y,{span:18},{default:a(()=>[e(we,{name:n.value.name,tableInfoColumn:t.value},null,8,["name","tableInfoColumn"])]),_:1})]),_:1})])}}}),$e=Z(Ve,[["__scopeId","data-v-a37b621c"]]);export{$e as default};
