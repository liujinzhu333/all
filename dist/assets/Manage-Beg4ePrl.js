import"./FormItem.vue_vue_type_style_index_0_scoped_4a704015_lang-BXUN_8Ur.js";import{a as de}from"./axios-upsvKRUO.js";import{d as O,r as w,z as W,p as o,o as u,c as C,e as f,u as $,f as k,g as S,h as Y,a,w as t,b as A,F as j,i as h,t as F,A as Z,B as Q,C as ee,_ as te,k as ie}from"./index-DECn1nDO.js";const p=de.create({baseURL:"/all/db",timeout:1e4}),re=s=>{if(s.url==="/api/db/table/list")return"/data/sqlite_sequence.json";if(s.url==="/api/db/table/info"){const{name:_}=s.params;return`/table_info/${_}.json`}const e=/^\/api\/db\/table\/([^/]+)\/list$/,n=s.url.match(e);if(e.test(s.url))return`/data/${n[1]}.json`};p.interceptors.request.use(s=>(s.url=re(s),s),s=>Promise.reject(s));p.interceptors.response.use(s=>s.data,s=>{if(s.response)switch(s.response.status){}return Promise.reject(s)});class ce{async getDatabaseConnectStatus(){return p.get("/api/db/status")}async connectDatabase(){return p.get("/api/db/connect")}async closeConnection(){return p.get("/api/db/close")}async getAllDataJson(){return p.get("/api/db/get_json")}async getAllTable(){return p.get("/api/db/table/list")}async addTable(e,n){return p.post("/api/db/table/create",{name:e,keys:n})}async delTable(e){return p.get("/api/db/table/delete",{params:{name:e}})}async addTableColumn(e,n){return p.post("/api/db/table/add_column",{name:e,keys:n})}async getTableInfo(e){return p.get("/api/db/table/info",{params:{name:e}})}async getDataList(e,n){return p.get(`/api/db/table/${e}/list`,{params:n})}async addDataItem(e,n){return p.post(`/api/db/table/${e}/add`,n)}async deleteDataItem(e,n){return p.get(`/api/db/table/${e}/delete`,{params:{id:n}})}async updateDataItem(e,n){return p.post(`/api/db/table/${e}/update`,n)}async getDataInfo(e,n){return p.get(`/api/db/table/${e}/info`,{params:{id:n}})}}const y=new ce,N=!1,me={style:{display:"flex","align-items":"center","justify-content":"space-between"}},pe=O({__name:"Database",setup(s){const e=w(!1),n=async()=>{const{connected:m}=await y.getDatabaseConnectStatus();e.value=m},_=async()=>{const{connected:m}=await y.connectDatabase();e.value=m},V=async()=>{const{connected:m}=await y.closeConnection();e.value=m},b=m=>{m?_():V()};return W(()=>{n()}),(m,v)=>{const I=o("el-switch");return u(),C("div",me,[v[1]||(v[1]=f(" 数据库 ")),$(N)?(u(),k(I,{key:0,modelValue:e.value,"onUpdate:modelValue":v[0]||(v[0]=D=>e.value=D),onChange:b},null,8,["modelValue"])):S("",!0)])}}}),_e=["onClick"],be={style:{display:"flex",gap:"5px"}},fe={key:0},ye={class:"dialog-footer"},ve=O({__name:"DataBaseTableNav",emits:["select"],setup(s,{emit:e}){const n=e,_=[{title:"cid",key:"cid",isEdit:!1},{title:"name",key:"name"},{title:"type",key:"type"},{title:"notnull",key:"notnull"},{title:"dflt_value",key:"dflt_value"},{title:"pk",key:"pk"}],V=w(),b=w([]),m=w([]),v=Y(()=>[...b.value,...m.value]),I=async()=>{const r=await y.getAllTable()||[];V.value=r},D=async r=>{await y.delTable(r),I()},z=r=>{n("select",r.name)},P=async()=>{if(!g.value.name)return;const r=v.value.filter(l=>l.isAdd);await y.addTable(g.value.name,r),I()},T=async()=>{const r=v.value.filter(l=>l.isAdd);await y.addTableColumn(g.value.name,r)},c=async r=>{b.value=await y.getTableInfo(r)},E=async()=>{await y.getAllDataJson()},L=w(!1),g=w({name:""}),B=w(""),J=()=>{L.value=!1,B.value="",m.value=[]},q=r=>{r?(B.value=r.name,g.value={...r},c(r.name)):(g.value={name:""},b.value=[]),L.value=!0},G=async()=>{B.value?B.value!==g.value.name||await T():await P(),J()},X=()=>{m.value.push({isAdd:!0})};return W(()=>{I()}),(r,l)=>{const i=o("el-button"),U=o("el-text"),R=o("el-link"),K=o("el-input"),ae=o("el-form-item"),M=o("el-option"),le=o("el-select"),ne=o("el-table-column"),oe=o("el-table"),se=o("el-form"),ue=o("el-dialog");return u(),C(j,null,[a(i,{size:"small",type:"primary",onClick:I},{default:t(()=>l[5]||(l[5]=[f("获取表")])),_:1}),$(N)?(u(),k(i,{key:0,size:"small",onClick:l[0]||(l[0]=d=>q())},{default:t(()=>l[6]||(l[6]=[f("添加数据表")])),_:1})):S("",!0),$(N)?(u(),k(i,{key:1,size:"small",onClick:l[1]||(l[1]=d=>E())},{default:t(()=>l[7]||(l[7]=[f("导出")])),_:1})):S("",!0),A("div",null,[(u(!0),C(j,null,h(V.value,d=>(u(),C("div",null,[A("div",{class:"table-item",onClick:x=>z(d)},[a(U,{class:"mx-1"},{default:t(()=>[f(F(d.name),1)]),_:2},1024),A("div",be,[$(N)?(u(),k(R,{key:0,type:"primary",icon:$(Z),onClick:Q(x=>q(d),["stop"])},null,8,["icon","onClick"])):S("",!0),$(N)?(u(),k(R,{key:1,type:"danger",icon:$(ee),onClick:Q(x=>D(d.name),["stop"])},null,8,["icon","onClick"])):S("",!0)])],8,_e)]))),256))]),a(ue,{modelValue:L.value,"onUpdate:modelValue":l[4]||(l[4]=d=>L.value=d),title:"添加数据表",width:"700","before-close":J},{footer:t(()=>[A("div",ye,[a(i,{onClick:l[3]||(l[3]=d=>L.value=!1)},{default:t(()=>l[9]||(l[9]=[f("取消")])),_:1}),a(i,{type:"primary",onClick:G},{default:t(()=>l[10]||(l[10]=[f(" 确定 ")])),_:1})])]),default:t(()=>[a(se,{model:g.value,"label-width":"auto",style:{"max-width":"600px"}},{default:t(()=>[a(ae,{label:"数据表名"},{default:t(()=>[a(K,{modelValue:g.value.name,"onUpdate:modelValue":l[2]||(l[2]=d=>g.value.name=d)},null,8,["modelValue"])]),_:1}),a(oe,{data:v.value,style:{width:"100%"},border:""},{default:t(()=>[(u(),C(j,null,h(_,d=>a(ne,{label:d.title,prop:d.key},{default:t(x=>[x.row.isAdd&&d.isEdit!==!1?(u(),C("div",fe,[d.key==="type"?(u(),k(le,{key:0,modelValue:x.row[d.key],"onUpdate:modelValue":H=>x.row[d.key]=H},{default:t(()=>[a(M,{value:"TEXT"}),a(M,{value:"INTEGER"}),a(M,{value:"NULL"}),a(M,{value:"REAL"}),a(M,{value:"BLOB"})]),_:2},1032,["modelValue","onUpdate:modelValue"])):(u(),k(K,{key:1,modelValue:x.row[d.key],"onUpdate:modelValue":H=>x.row[d.key]=H},null,8,["modelValue","onUpdate:modelValue"]))])):(u(),k(U,{key:1},{default:t(()=>[f(F(x.row[d.key]),1)]),_:2},1024))]),_:2},1032,["label","prop"])),64))]),_:1},8,["data"]),a(i,{class:"mt-4",style:{width:"100%"},onClick:X},{default:t(()=>l[8]||(l[8]=[f(" 添加字段 ")])),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),ke=te(ve,[["__scopeId","data-v-228d8a2e"]]),we={class:"card-header"},ge={key:0},Ce={class:"dialog-footer"},Ve=O({__name:"TableData",props:{name:{},tableInfoColumn:{}},setup(s){const e=s,n=w(),_=w({}),V=Y(()=>e.tableInfoColumn?e.tableInfoColumn:[]),b=async()=>{n.value=await y.getDataList(e.name,{})},m=async()=>{await y.addDataItem(e.name,_.value),b()},v=async()=>{await y.updateDataItem(e.name,_.value),b()},I=async T=>{await y.deleteDataItem(e.name,T.id),b()},D=w(!1),z=T=>{_.value=T?{...T}:{},D.value=!0},P=async()=>{_.value.id?await v():await m(),D.value=!1};return ie(()=>e.name,()=>b()),b(),(T,c)=>{const E=o("el-button"),L=o("el-link"),g=o("el-text"),B=o("el-table-column"),J=o("el-table"),q=o("el-card"),G=o("el-input"),X=o("el-form-item"),r=o("el-form"),l=o("el-dialog");return u(),C(j,null,[a(q,{shadow:"always",title:""},{header:t(()=>[A("div",we,[A("span",null,"数据表("+F(T.name)+")数据",1)])]),default:t(()=>[$(N)?(u(),k(E,{key:0,onClick:c[0]||(c[0]=i=>z())},{default:t(()=>c[3]||(c[3]=[f("添加")])),_:1})):S("",!0),a(J,{data:n.value,style:{width:"100%"},border:""},{default:t(()=>[(u(!0),C(j,null,h(V.value,i=>(u(),k(B,{label:i.title,prop:i.key},{default:t(U=>[i.key==="action"?(u(),C("div",ge,[a(L,{type:"primary",icon:$(Z),onClick:R=>z(U.row)},{default:t(()=>c[4]||(c[4]=[f(" 修改 ")])),_:2},1032,["icon","onClick"]),a(L,{type:"danger",icon:$(ee),style:{"margin-left":"10px"},onClick:R=>I(U.row)},{default:t(()=>c[5]||(c[5]=[f(" 删除 ")])),_:2},1032,["icon","onClick"])])):(u(),k(g,{key:1},{default:t(()=>[f(F(U.row[i.key]),1)]),_:2},1024))]),_:2},1032,["label","prop"]))),256))]),_:1},8,["data"])]),_:1}),a(l,{modelValue:D.value,"onUpdate:modelValue":c[2]||(c[2]=i=>D.value=i)},{footer:t(()=>[A("div",Ce,[a(E,{onClick:c[1]||(c[1]=i=>D.value=!1)},{default:t(()=>c[6]||(c[6]=[f("取消")])),_:1}),a(E,{type:"primary",onClick:P},{default:t(()=>c[7]||(c[7]=[f(" 确定 ")])),_:1})])]),default:t(()=>[a(r,{model:_.value,"label-width":"auto",style:{"max-width":"600px"}},{default:t(()=>[(u(!0),C(j,null,h(T.tableInfoColumn,i=>(u(),k(X,{label:i.title},{default:t(()=>[a(G,{modelValue:_.value[i.key],"onUpdate:modelValue":U=>_.value[i.key]=U,disabled:i.key==="id"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["label"]))),256))]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),Ie={class:"manage-page"},$e=O({__name:"Manage",setup(s){const e=w(),n=w({name:"",list:[]}),_=async V=>{n.value.list=await y.getTableInfo(V),n.value.name=V,e.value=n.value.list.map(b=>({title:b.name,key:b.name}))};return(V,b)=>{const m=o("el-card"),v=o("el-col"),I=o("el-row");return u(),C("div",Ie,[a(I,{gutter:20},{default:t(()=>[a(v,{span:6},{default:t(()=>[a(m,{shadow:"always"},{header:t(()=>[a(pe)]),default:t(()=>[a(ke,{onSelect:_})]),_:1})]),_:1}),a(v,{span:18},{default:t(()=>[a(Ve,{name:n.value.name,tableInfoColumn:e.value},null,8,["name","tableInfoColumn"])]),_:1})]),_:1})])}}}),Le=te($e,[["__scopeId","data-v-a37b621c"]]);export{Le as default};
